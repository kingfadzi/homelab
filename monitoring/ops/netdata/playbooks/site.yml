- name: Netdata collectors
  hosts: collectors
  become: true
  roles:
    - netdata_agent
    - netdata_collectors

- name: Netdata agents on Linux nodes (explicitly gated)
  hosts: linux_nodes
  become: true
  roles:
    - role: netdata_agent
      when: netdata_allow_vm_agents | bool
  handlers:
    - name: restart netdata
      ansible.builtin.systemd:
        name: netdata
        state: restarted
